<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>논문 요약 서비스</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">
      window.onload = () => {
        let msg = document.getElementById("msg");

        send.addEventListener("click", function () {
          // 선택한 파일 데이터 저장 ★
          const formData = new FormData();
          // 태그 id가 'file'인 태그의 파일 갯수
          const cnt = document.getElementById("file").files.length;

          if (cnt == 0) {
            msg.innerHTML =
              '<span style="color: red">파일 선택이 안되었습니다.</span>';
            return; // 실행 종료
          }

          for (let x = 0; x < cnt; x++) {
            formData.append("file", document.getElementById("file").files[x]);
          }

          msg.innerHTML =
            '<img src="/static/images/progress.gif" style="width: 15%; margin-top: 0px;">';
          //비동기 통신(업로드)
          fetch("http://localhost:5000/pdf_text", {
            method: "post",
            body: form_data,
          }) //요청
            .then((response) => response.json()) //응답을 받는다.
            .then((data) => {
              if (data.message) {
                msg.innerHTML = data.message;
              } else {
                msg.innerHTML = data.summary;
              }
            }); //응답처리한것을 다시 받는다.
        });
      };
    </script>
  </head>
  <body>
    <div style="margin: 10px auto; width: 90%; text-align: center">
      <h4>업로드 논문 요약 서비스</h4>
      <form>
        <div class="d-flex justify-content-center">
          <input
            type="file"
            id="file"
            class="btn btn-info btn-sm"
            style="margin-right: 5px"
          />

          <button type="button" id="send" class="btn btn-info btn-sm">
            업로드
          </button>
          <br />
        </div>
      </form>

      <!--  업로드 관련 메시지 출력 -->
      <div
        id="msg"
        style="margin: 20px auto; width: 800px; text-align: center"
      ></div>
    </div>
  </body>
</html>
